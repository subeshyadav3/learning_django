<!DOCTYPE html>
<html>
<head>
    <title>Simple Cart</title>
    <script src="https://code.jquery.com/jquery-3.7.1.min.js"></script>
    <style>
        body { display: flex; gap: 40px; }
        #products { width: 60%; }
        #cart { width: 40%; border-left: 2px solid #ccc; padding-left: 20px; }
    </style>
</head>
<body>

{% csrf_token %}

<div id="products">
    <h2>Products</h2>
    <ul>
        {% for p in items %}
            <li>
                {{ p.name }} - ₹{{ p.price }}
                <button onclick="addToCart({{ p.id }})">Add</button>
            </li>
        {% endfor %}
    </ul>
</div>

<div id="cart">
    <h2>Cart</h2>
    <ul id="cart-items">
        {% for item in cart.values %}
            <li>{{ item.name }} x {{ item.qty }}</li>
        {% endfor %}
    </ul>
    <h3>Total: ₹<span id="total">{{ total }}</span></h3>
</div>

<script>
function getCSRF() {
    return document.querySelector('[name=csrfmiddlewaretoken]').value;
}

function loadCart() {
    $.get('/cart/', function(res) {
        $('#cart-items').empty();
        Object.values(res.cart).forEach(item => {
            $('#cart-items').append(
                `<li>${item.name} x ${item.qty}</li>`
            );
        });
        $('#total').text(res.total);
    });
}

function addToCart(id) {
    $.ajax({
        url: '/cart/',
        type: 'POST',
        headers: { 'X-CSRFToken': getCSRF() },
        data: { item_id: id },
        success: loadCart
    });
}
</script>

</body>
</html>
